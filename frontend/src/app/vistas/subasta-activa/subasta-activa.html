<div class="active-auction-container">
    <div class="auction-header">
        <h1>SUBASTA ACTIVA · EN VIVO</h1>
    </div>

    <div class="auction-grid">
        <!-- Main Section: Video/Stream & Controls -->
        <div class="main-content">
            <div class="stream-container">
                <div class="video-placeholder">
                    <!-- Stream Content -->
                    <div class="placeholder-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none"
                            stroke="#888" stroke-width="1">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </div>
                </div>
                <!-- Banner Over Stream -->
                <div class="stream-banner">
                    <span class="banner-text">SE VENDE EN ${{ currentBid | number:'1.0-0' }}</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="white" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                </div>
            </div>

            <!-- Bidding Controls -->
            <div class="bidding-section">
                <div class="bid-selector">
                    <button class="bid-btn minus" (click)="decreaseBid()">-</button>
                    <div class="bid-display">
                        <div class="bid-field-wrapper">
                            <span class="currency-symbol">$</span>
                            <input type="text" [(ngModel)]="formattedBid" class="bid-input"
                                (keypress)="onlyNumbers($event)">
                        </div>
                        <span class="user-credits">TUS CRÉDITOS: ${{ userCredits | number:'1.0-0' }}</span>
                    </div>
                    <button class="bid-btn plus" (click)="increaseBid()">+</button>
                </div>
                <button class="offer-btn" (click)="placeOffer()">OFERTAR</button>
            </div>
        </div>

        <!-- Sidebar: Unified Card Design -->
        <aside class="sidebar">
            <div class="sidebar-card">
                <!-- Martillero Video Area -->
                <div class="martillero-video-block">
                    <div class="camera-placeholder">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none"
                            stroke="#888" stroke-width="1">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </div>
                </div>

                <!-- Martillero Name Banner -->
                <div class="martillero-banner">
                    <span class="label">MARTILLERO</span>
                    <span class="name">{{ loteInfo.martillero }}</span>
                </div>

                <!-- Collapse Toggle Button (Mobile Only Ideal, but useful generally) -->
                <button class="toggle-chat-btn" (click)="toggleChat()">
                    <span *ngIf="isChatExpanded">^ Ocultar chat y descripción</span>
                    <span *ngIf="!isChatExpanded">v Mostrar chat y descripción</span>
                </button>

                <!-- Lote Info & Chat Wrapper -->
                <div class="sidebar-body" [class.collapsed]="!isChatExpanded">
                    <div class="lote-info-compact">
                        <div class="title-row">
                            <h3>{{ loteInfo.nombre }}</h3>
                            <button class="btn-negro-extra-small" (click)="openLightbox()">VER LOTE</button>
                        </div>
                        <p class="location">
                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            {{ loteInfo.ubicacion }}
                        </p>
                        <p class="description-short">{{ loteInfo.descripcion }}</p>
                    </div>

                    <hr class="sidebar-divider">

                    <!-- Chat Section Integrated -->
                    <div class="chat-container-inner">
                        <div class="chat-header-minimal">CHAT EN VIVO ·</div>
                        <div class="chat-messages-scroll" #scrollMe>
                            <div *ngFor="let msg of messages" class="message" [ngClass]="{'is-offer': msg.isOffer}">
                                <span class="message-user">{{ msg.user }}:</span>
                                <span class="message-text">{{ msg.text }}</span>
                                <span class="message-time">{{ msg.time }}</span>
                            </div>
                        </div>
                        <div class="chat-input-row">
                            <input type="text" [(ngModel)]="newMessage" placeholder="Tu mensaje..."
                                (keyup.enter)="sendMessage()">
                            <button class="send-btn" (click)="sendMessage()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- SIMPLE LIGHTBOX MODAL (Like Catalog) -->
    <div class="lightbox-overlay" *ngIf="isLightboxOpen" (click)="closeLightbox()">
        <div class="lightbox-container" (click)="$event.stopPropagation()">
            <button class="close-btn" (click)="closeLightbox()">×</button>

            <div class="media-viewer">
                <img [src]="loteInfo.imagenes[currentIndex]" alt="Lote Media">

                <button class="nav-btn prev" (click)="prevImage()">‹</button>
                <button class="nav-btn next" (click)="nextImage()">›</button>
            </div>

            <div class="lightbox-footer">
                <p>{{ loteInfo.nombre }} - Imagen {{ currentIndex + 1 }} de {{ loteInfo.imagenes.length }}</p>
            </div>
        </div>
    </div>
</div>